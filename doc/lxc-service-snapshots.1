.\" Text automatically generated by txt2man
.TH lxc-service-snapshots 1 "30 November 2018" "" ""
.SH NAME
\fBlxc-service-snapshots \fP- Run disposable (read-only then delete) Linux containers (LXC) to serve up OpenVPN (server only), Pi-Hole, or WireGuard.
\fB
.SH DESCRIPTION
Lxc-service-snapshots creates a temporary clone (a new container) from a "base container" via an overlayfs mount. The overlayfs mount is very innovative in that it is a read-only copy of the base container. Only the changes are written to the snapshotted container so all key system files are protected since they are by design, read-only. When stopped, the snapshotted container is completely destroyed leaving the base container untouched with the exception of a few config and data files unique to Pi-Hole. These are saved and injected back into the base image by lxc-service-snapshots.
.PP
Notable advantages of snapshotting include:
.IP \(bu 3
Increased security. This is particularly true if the snapshotted container is Internet-facing via forwarded ports. Since the primary file system is mounted back to the base LXC via a read-only overlay, and since the snapshotted LXC is destroyed upon systemd stopping it, anything potentially compromised therein is also destroyed.
.IP \(bu 3
Simplified administrative overhead (i.e. updates to the base LXC are seamlessly applied to all snapshotted containers by virtue of the overlayfs mount).
.IP \(bu 3
Minimized disk space and system resources.
.SH SETUP
Build a "base" container is needed. Simple create a new one or use an existing one. Install the need dependencies for either Pi-Hole, WireGuard, and/or OpenVPN. As well, fully configuring the respective software, setup up a firewall within the container, etc. Doing so is beyond the scope of this man page.
.PP
Refer to the following if needed:
.PP
.nf
.fam C
        https://wiki.archlinux.org/index.php/Linux_Containers
        https://wiki.archlinux.org/index.php/OpenVPN_(server)_in_Linux_containers
        https://wiki.archlinux.org/index.php/Pi-hole
        https://wiki.archlinux.org/index.php/WireGuard

.fam T
.fi
Note - Do not enable any systemd services specific to Pi-Hole, OpenVPN, or WireGuard in the base. Lxc-service-snapshots will do this. Do enable the firewall in the base image.
.PP
Once the base container is setup:
.IP \(bu 3
Make sure the base LXC is stopped, then edit or diff /var/lib/lxc/base/config against /usr/share/lxc-service-snapshots/config.
.IP \(bu 3
Adjust the lxc.arch = to match the arch of the base container.
.IP \(bu 3
Adjust the lxc.include = to match the correct template matching the base container.
.IP \(bu 3
Optionally adjust the lxc.net.0.hwaddr =
.IP \(bu 3
If running OpenVPN in the container, (you haven't already created one) copy /usr/share/lxc-service-snapshots/autodev to /var/lib/lxc/base/.
.IP \(bu 3
Edit the global config files, which are well commented:
.IP \(bu 3
For OpenVPN, setup /etc/conf.d/openvpn-lss.conf to your liking.
.IP \(bu 3
For Pi-Hole, setup /etc/conf.d/pihole-lss.conf to your liking.
.IP \(bu 3
For WireGuard, setup /etc/conf.d/wireguard-lss.conf to your liking.
.SH RUNNING
.IP \(bu 3
To start the OpenVPN container, run: systemctl start openvpn-lss
.IP \(bu 3
To start the Pi-Hole container, run: systemctl start pihole-lss
.IP \(bu 3
To start the WireGuard container, run: systemctl start wireguard-lss
.SH CONTRIBUTE
Users wishing to contribute to this code, should fork and send a pull request. Source is freely available on the project page linked below.
.RE
.PP

.SH BUGS
Discover a bug? Please open an issue on the project page linked below.
.IP \(bu 3
Only affecting pihole-lss\.\.\. Having an accurate clock is critical if keeping the query log updated is important to you. Usually, time-sync daemons such as systemd-timesyncd or ntpd will do this. However, some devices such as a Raspberry Pi, lack a hardware clock. Therefore, if pihole-lss.service is started before the clock has synchronized data loss can occur since systemd gets confused and rotates the pihole.log due to clock skew.
.IP \(bu 3
I am currently trying to figure out how to make pihole-lss.service wait until the system clock has been successfully synchronized before starting. See: https://github.com/systemd/systemd/issues/11008 for more. A work around is to run fake-hwclock (https://github.com/xanmanning/alarm-fake-hwclock) or from the AUR (https://aur.archlinux.org/packages/fake-hwclock-git/) until this is sorted.
.SH ONLINE
Project page: https://github.com/graysky2/lxc-service-snapshots
.SH AUTHOR
graysky (graysky AT archlinux DOT us)
